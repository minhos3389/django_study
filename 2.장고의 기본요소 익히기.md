# 2장 장고의 기본 요소 익히기

## 2-01 주소와 화면을 연결하는 URL과 뷰

## 앱 생성하고 확인하기

### pybo 앱 생성하기
- django-admin의 startapp 명령을 이용하여 pybo라는 이름의 앱을 생성
```
(mysite) C:\projects\mysite>django-admin startapp pybo
(mysite) C:\projects\mysite>
```

개발서버를 구동하고 localhost:8000/pybo 접속시 Page not found(404) 에러 발생. <br>
사용자가 요청한 페이지를 찾을 수 없는 경우 발생하는 HTTP 오류 코드 중 하나이다.<br>
장고는 사용자가 웹 브라우저에서 /pybo/라는 페이지를 요청하면 해당 페이지를 가져오는 URL 매핑이 있는지 config/urls.py 파일을 찾아본다.<br>
그런데 아직/pybo/페이지에 해당하는 URL매핑을 장고에 등록하지 않았으므로 /pybo/페이지를 찾을 수 없다는 메시지를 보내는 것이다.

### config/urls.py 수정하기
config/urls.py를 수정한다. 'URL 매핑을 추가한다'라고 말한다.
>  config/urls.py 파일은 페이지 요청 시 가장 먼저 호출되며, 요청 URL과 뷰 함수를 1:1로 연결해준다.
>  뷰 함수는 아직 살펴보지 않았다. 뷰 함수는 보여 주기 위한 함수로, views.py파일에 있는 함수이다.

[C:\projects\mysite\config\urls.py]
```
from django.contrib import admin
from django.urls import path

from pybo import views

urlpatterns = [
    path('admin/', admin.site.urls),

    path('pybo/', views.index),  # views.index는 views.py파일의 index함수를 의미한다.
]
```
<br>
코드의 urlpatterns 변수를 보면 path 함수를 사용하여 pybo/URL과 views.index를 매핑했다.

![url.py와 views.py가 매핑되어연결된모습](https://wikidocs.net/images/page/70649/2-01_4.png)

pybo에 슬래시 / 를 붙여 입력한 이유는 슬래시를 붙이면 사용자가 슬래시 없이 주소를 입력해도 장고가 자동으로 슬래시를 붙여 주기 때문이다.<br>
URL 정규화하는 장고의 기능 덕분이다. URL 매핑에는 호스트명과 포트를 생략하고 끝에는 슬래시를 붙이도록 한다.

> localhost:8000/pybo 입력시 장고가 자동으로 localhost:8000/pybo/ 로 슬래시를 붙여준다.


### 오류 메시지 확인
views.index 가 없기 때문에 에러발생.

### pybo/views.py 작성
[파일이름: c:\projects\mysite\pybo\views.py]
```
from django.http import HttpResponse

def index(request):
    return HttpResponse("안녕하세요 pybo에 오신것을 환영합니다.")
```

- index 함수의 매개변수인 **request는 장고에 의해 자동으로 전달되는 HTTP요청 객체**
- request는 **사용자가 전달한 데이터를 확인**할 때 사용된다.

return 문에 사용된 HttpResponse는 페이지 요청에 대한 응답을 할 때 사용하는 장고 클래스이다. 여기서는 HttpResponse에 문자열을 전달하여 이 문자열이
웹 브라우저에 그대로 출력되도록 했다.

### 장고 개발 흐름 정리

![장고개발흐름정리](https://wikidocs.net/images/page/70649/2-01_6.png)

1. 웹 브라우저 주소창에 localhost:8000/pybo 입력(장고 개발 서버에 /pybo 페이지 요청)
2. config/urls.py 파일에서 URL을 해석해 pybo/views.py 파일의 index 함수 호출
3. pybo/views.py 파일의 index 함수를 실행하고 그 결과를 웹 브라우저로 전달.

<br>
<br>

## URL 분리하기

pybo 앱 관련 파일은 대부분 pybo 디렉터리에 있으나 매핑을 위한 urls.py 파일은 pybo 디렉터리가 아닌 config디렉터리에 존재하므로 <br>
config 디렉터리에 있는 urls.py 파일을 수정해준다.

[파일이름: c:\projects\mysite\config\urls.py]
```
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),

    path('pybo/', include('pybo/urls')),
]
```
include 함수를 import 해서 pybo/의 URL 매핑을 수정.
path('pybo/', include('pybo/urls')) 는 pybo/로 시작되는 페이지 요청은 모두 pybo/urls.py 파일에 있는 URL 매핑을 참고하여 처리하라는 의미이다. <br>
다시 말해 pybo 앱과 관련된 URL요청은 앞으로 pybo/urls.py 파일에서 관리하라는 의미이다. 


|URL 요청|요청 처리 파일|
|:--|:--|
|pybo/question/create/|pybo/urls.py|
|pybo/answer/create/|pybo/urls.py|
|그외|config/urls.py|

### pybo/urls.py 생성 및 수정
[파일이름: C:\projects\mysite\pybo\urls.py]
```
from django.urls import path

from . import views

urlpatterns = [
    path('', views.index)
]
```

|config/urls.py||pybo/urls.py||최종 URL|
|'pybo/'|+|''|=|'pybo/'|

![장고가 URL 매핑을 확인하는 과정](https://wikidocs.net/images/page/70649/2-01_10.png) 

이 과정을 이해하는 것은 무척 중요하므로 다른 예로도 설명해 보겠다. 만약 pybo/urls.py 파일에 path('question/create/', ...)가 추가 된다면 config/urls.py 파일과 pybo/urls.py 파일에 의해 최종 매핑되는 URL은 pybo/question/create/가 될 것이다.